{% extends 'base.html' %}

{% block title %}Radar de Oportunidades{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 text-gray-800 fw-bold"><i class="bi bi-broadcast"></i> Radar de Mercado</h1>
        <p class="text-muted">O Robô analisou as principais ações da bolsa e encontrou estas oportunidades baseadas em Graham & Bazin.</p>
    </div>
    <a href="{% url 'investimentos_dashboard' %}" class="btn btn-secondary">Voltar</a>
</div>

{% if oportunidades %}
    <div class="row">
        {% for op in oportunidades %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card shadow border-0 border-start border-success border-5 h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="fw-bold mb-0 text-primary">{{ op.ticker }}</h4>
                        <span class="badge bg-success">COMPRA FORTE</span>
                    </div>
                    
                    <h2 class="text-center fw-bold my-3">R$ {{ op.preco|floatformat:2 }}</h2>
                    
                    <div class="bg-light p-3 rounded">
                        <small class="text-uppercase text-muted fw-bold">Por que comprar?</small>
                        <ul class="list-unstyled mt-2 mb-0 small">
                            {% if op.tipo == 'ACAO' %}
                                <li class="d-flex justify-content-between">
                                    <span>P/L (Barato)</span> <strong>{{ op.detalhes.pl|floatformat:1 }}</strong>
                                </li>
                                <li class="d-flex justify-content-between">
                                    <span>P/VP (Justo)</span> <strong>{{ op.detalhes.pvp|floatformat:2 }}</strong>
                                </li>
                                <li class="d-flex justify-content-between">
                                    <span>Dividendos</span> <strong class="text-success">{{ op.detalhes.dy|floatformat:1 }}%</strong>
                                </li>
                            {% elif op.tipo == 'FII' %}
                                <li class="d-flex justify-content-between">
                                    <span>Dividend Yield</span> <strong class="text-success">{{ op.detalhes.dy|floatformat:1 }}%</strong>
                                </li>
                                <li class="d-flex justify-content-between">
                                    <span>P/VP</span> <strong>{{ op.detalhes.pvp|floatformat:2 }}</strong>
                                </li>
                            {% else %}
                                <li>Ativo de Cripto em tendência de valor.</li>
                            {% endif %}
                        </ul>
                    </div>
                    
                    <div class="mt-3 text-center">
                        <a href="https://www.google.com/search?q=cotação+{{ op.ticker }}" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                            Ver no Google <i class="bi bi-box-arrow-up-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-warning text-center py-5">
        <i class="bi bi-search fs-1"></i>
        <h4 class="mt-3">Nenhuma oportunidade encontrada hoje.</h4>
        <p>O mercado está caro ou os ativos monitorados não passaram nos critérios estritos de segurança.</p>
    </div>
{% endif %}

{% endblock %}